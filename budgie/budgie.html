<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Budgie</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="budgie-icon.png">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#0d0d0d; color:#fff; font-family:-apple-system; text-align:center; padding:40px 20px; min-height:100vh; }
    h1 { color:#00d4ff; font-size:2.2em; margin-bottom:18px; text-shadow:0 0 10px rgba(0,212,255,0.4); }
    h1::before { content:"üê¶ "; }
    #balance { font-size:4.3em; font-weight:800; margin:32px 0; letter-spacing:-1px; }
    input, button { width:88%; max-width:360px; padding:18px; margin:14px auto; display:block; font-size:1.5em; border-radius:18px; }
    input { background:#1a1a1a; color:#fff; border:2px solid #333; transition:all 0.3s; }
    input:focus { border-color:#00d4ff; box-shadow:0 0 0 4px rgba(0,212,255,0.25); outline:none; }
    input::placeholder { color:#888; }
    button { background:linear-gradient(135deg,#00d4ff,#0099cc); color:white; border:none; font-weight:bold; box-shadow:0 4px 15px rgba(0,212,255,0.4); transition:all 0.2s; }
    button:active { transform:scale(0.97); }
    .reset { background:linear-gradient(135deg,#ff3b5c,#e74c3c) !important; box-shadow:0 4px 15px rgba(255,59,92,0.4); margin-top:35px; }
    .history { margin-top:45px; text-align:left; max-width:380px; margin:auto; }
    .history h3 { color:#aaa; text-align:center; margin-bottom:12px; font-size:1em; }
    .history-item { background:#1a1a1a; padding:14px; margin:7px 0; border-radius:14px; border-left:4px solid #00d4ff; color:#ccc; font-size:0.95em; box-shadow:0 1px 4px rgba(0,0,0,0.3); }
    .history-item.spent { border-left-color:#ff3b5c; }
  </style>
</head>
<body>
  <h1>Budgie</h1>
  <div id="balance">$0.00</div>

  <input type="number" step="0.01" placeholder="Set starting budget" id="startInput" />
  <button onclick="setBudget()">Set Budget</button>

  <input type="number" step="0.01" placeholder="How much did you spend?" id="spendInput" />
  <button onclick="subtract()">Subtract Spending</button>

  <div class="history">
    <h3>Recent Chirps</h3>
    <div id="historyList"></div>
  </div>

  <button class="reset" onclick="resetAll()">Reset Budgie</button>

  <script>
    const $ = id => document.getElementById(id);
    let balance = 0;
    let history = JSON.parse(localStorage.getItem('budgieHistory') || '[]');

    function format(n) { return `$${Math.abs(n).toFixed(2)}`; }

    function update() {
      $('balance').textContent = format(balance);
      renderHistory();
    }

    window.setBudget = () => {
      const val = parseFloat($('startInput').value);
      if (isNaN(val) || val < 0) return alert("Enter a valid budget.");
      balance = val;
      addHistory(`Set: +${format(val)}`, 'set');
      saveBalance();
      $('startInput').value = '';
      update();
    };

    window.subtract = () => {
      const val = parseFloat($('spendInput').value);
      if (isNaN(val) || val <= 0) return alert("Enter a valid spend.");
      if (val > balance && !confirm(`$${val.toFixed(2)} > balance. Continue?`)) return;
      balance -= val;
      addHistory(`Spent: -${format(val)}`, 'spent');
      saveBalance();
      $('spendInput').value = '';
      update();
    };

    function addHistory(txt, type) {
      const time = new Date().toLocaleTimeString([], {hour: 'numeric', minute: '2-digit', hour12: true});
      history.push({txt, time, type});
      if (history.length > 50) history.shift();
      localStorage.setItem('budgieHistory', JSON.stringify(history));
    }

    function saveBalance() {
      localStorage.setItem('budgieBalance', balance.toFixed(2));
    }

    function renderHistory() {
      const list = $('historyList');
      list.innerHTML = '';
      if (!history.length) {
        list.innerHTML = '<div style="color:#666; font-style:italic;">Budgie is quiet...</div>';
        return;
      }
      history.slice(-10).reverse().forEach(item => {
        const div = document.createElement('div');
        div.className = 'history-item';
        if (item.type === 'spent') div.classList.add('spent');
        div.innerHTML = `<strong>${item.txt}</strong><br><small>${item.time}</small>`;
        list.appendChild(div);
      });
    }

    window.resetAll = () => {
      if (confirm("Reset Budgie and all chirps?")) {
        balance = 0; history = [];
        localStorage.removeItem('budgieHistory');
        localStorage.removeItem('budgieBalance');
        update();
      }
    };

    // LOAD SAVED BALANCE
    const savedBalance = localStorage.getItem('budgieBalance');
    if (savedBalance !== null) {
      balance = parseFloat(savedBalance);
    } else if (history.length) {
      let temp = 0;
      history.forEach(h => {
        if (h.txt.includes('Set')) temp = parseFloat(h.txt.match(/\$([\d.]+)/)[1]);
        else if (h.txt.includes('Spent')) temp -= parseFloat(h.txt.match(/\$([\d.]+)/)[1]);
      });
      balance = temp > 0 ? temp : 0;
    }

    update();
  </script>
</body>
</html>
